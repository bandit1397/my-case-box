<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>단속 법규 검색 시스템</title>

<style>
  body {
    font-family: "Apple SD Gothic Neo", sans-serif;
    margin: 20px;
    background: #f5f5f5;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  #searchBox {
    width: 100%;
    padding: 12px;
    font-size: 1em;
    margin-bottom: 20px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  #results {
    background: white;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  .lawItem {
    margin-bottom: 15px;
    padding: 12px;
    border-left: 5px solid #007bff;
  }
  .lawItem h3 {
    margin: 0 0 6px 0;
    font-size: 1.05em;
    color: #007bff;
  }
  .lawItem p {
    margin: 0;
    font-size: 0.95em;
    line-height: 1.4;
  }
  .note {
    margin-top: 6px;
    font-size: 0.9em;
    color: #ff6600;
  }
  .loading {
    text-align: center;
    color: #666;
    font-size: 0.9em;
  }
</style>
</head>

<body>

<h1>단속 법규 검색 시스템</h1>

<input
  type="text"
  id="searchBox"
  placeholder="단어 입력 (예: 노점, 청소년, 심야, 신호위반)"
  disabled
/>

<div id="results">
  <p class="loading">법규 데이터 불러오는 중...</p>
</div>

<script>
// ===============================
// 1. 전역 데이터
// ===============================
let lawsData = [];

// ===============================
// 2. JSON 로딩 (같은 폴더)
// ===============================
fetch("./lawsData.json")
  .then(res => {
    if (!res.ok) throw new Error("JSON 로딩 실패");
    return res.json();
  })
  .then(data => {
    lawsData = data;
    document.getElementById("searchBox").disabled = false;
    document.getElementById("results").innerHTML =
      "<p>검색어를 입력하세요.</p>";
    console.log("법규 데이터 로드 완료", lawsData);
  })
  .catch(err => {
    document.getElementById("results").innerHTML =
      "<p style='color:red;'>법규 데이터 로딩 실패</p>";
    console.error(err);
  });

// ===============================
// 3. 검색 함수
// ===============================
function searchLaw() {
  const input = document.getElementById("searchBox").value;

  // 1️⃣ , 기준으로 키워드 분리
  const keywords = input
    .split(",")
    .map(k => k.trim().toLowerCase())
    .filter(k => k.length > 0);

  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "";

  if (keywords.length === 0) {
    resultsDiv.innerHTML = "<p>검색어를 입력해주세요.</p>";
    return;
  }

  // 2️⃣ 모든 키워드가 포함된 경우만 필터링 (AND 조건)
  const results = lawsData.filter(item => {
    const text = item.text.toLowerCase();
    const note = item.note ? item.note.toLowerCase() : "";
    const lawText = item.law.join(" ").toLowerCase();

    return keywords.every(keyword =>
      text.includes(keyword) ||
      note.includes(keyword) ||
      lawText.includes(keyword)
    );
  });

  if (results.length === 0) {
    resultsDiv.innerHTML = "<p>검색 결과가 없습니다.</p>";
    return;
  }

  // 3️⃣ 결과 출력
  results.forEach(item => {
    const div = document.createElement("div");
    div.className = "lawItem";
    div.innerHTML = `
      <h3>${item.law.join(" / ")}</h3>
      <p>${item.text}</p>
      ${item.note ? `<p class="note">[현장 메모] ${item.note}</p>` : ""}
    `;
    resultsDiv.appendChild(div);
  });
}
// ===============================
// 4. 이벤트 연결
// ===============================
document
  .getElementById("searchBox")
  .addEventListener("input", searchLaw);
</script>

</body>
</html>
