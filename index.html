<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‹¨ì† ë²•ê·œ ê²€ìƒ‰ ì‹œìŠ¤í…œ + íŠ¸ë¦¬ ê¸°ëŠ¥</title>

<style>
body {
  font-family: "Apple SD Gothic Neo", sans-serif;
  margin: 0;
  background: #f5f5f5;
}
#container {
  display: flex;
  height: 100vh;
}

/* =======================
   LEFT TREE PANEL
======================== */
#treePanel {
  width: 260px;
  background: #fff;
  overflow-y: auto;
  border-right: 2px solid #ddd;
  padding: 15px;
}
.treeTitle {
  font-size:1.1em; font-weight:bold; margin-bottom:10px;
}
.treeNode {
  cursor:pointer;
  padding:6px 5px;
  border-radius:5px;
}
.treeNode:hover {
  background:#eee;
}
.treeNode.active {
  background:#cce1ff;
  border-left:4px solid #007bff;
}
.childGroup {
  margin-left:15px;
  display:none;
}
.open > .childGroup { display:block; }

/* =======================
   RIGHT PANEL
======================== */
#rightPanel {
  flex:1;
  padding:15px;
  overflow-y:auto;
}

#searchBox {
  width:100%;
  padding:12px;
  font-size:1em;
  margin-bottom:20px;
  border-radius:6px;
  border:1px solid #ccc;
}

#results {
  background:white;
  padding:15px;
  border-radius:6px;
  box-shadow:0 0 5px rgba(0,0,0,0.1);
}

.lawItem {
  margin-bottom:15px;
  padding:12px;
  border-left:5px solid #007bff;
  background:#fafafa;
}
.lawItem h3 {
  margin:0 0 6px 0;
  font-size:1.05em;
  color:#007bff;
}

.textContent {
  margin:0;
  font-size:0.95em;
  line-height:1.4;
  white-space:pre-line;
}

.note {
  margin-top:6px;
  font-size:0.9em;
  color:#ff6600;
  white-space:pre-line;
}

.highlight {
  background-color:#fff3cd;
  color:#d63300;
  font-weight:600;
  padding:0 2px;
  border-radius:3px;
}

.loading {
  text-align:center;
  color:#666;
  font-size:0.9em;
}
</style>
</head>

<body>

<div id="container">

<!-- ====================================
     LEFT TREE PANEL
======================================= -->
<div id="treePanel">

  <div class="treeTitle">ğŸ“‚ ë²•ê·œ ë¶„ë¥˜</div>

  <div class="treeNode" data-root="ë²•ë¥ ">ë²•ë¥ </div>
  <div class="childGroup">

    <div class="treeNode" data-root="ë²•ë¥ " data-mid="í˜•ë²•">í˜•ë²•</div>
    <div class="childGroup">

      <div class="treeNode" 
           data-root="ë²•ë¥ " 
           data-mid="í˜•ë²•" 
           data-leaf="í­í–‰">í­í–‰</div>

      <div class="treeNode" 
           data-root="ë²•ë¥ " 
           data-mid="í˜•ë²•" 
           data-leaf="ìƒí•´">ìƒí•´</div>

    </div>

    <div class="treeNode" data-root="ë²•ë¥ " data-mid="ë„ë¡œêµí†µë²•">ë„ë¡œêµí†µë²•</div>
    <div class="childGroup">

      <div class="treeNode" 
           data-root="ë²•ë¥ " 
           data-mid="ë„ë¡œêµí†µë²•" 
           data-leaf="ìŒì£¼ìš´ì „">ìŒì£¼ìš´ì „</div>

      <div class="treeNode" 
           data-root="ë²•ë¥ " 
           data-mid="ë„ë¡œêµí†µë²•" 
           data-leaf="ë¬´ë©´í—ˆ">ë¬´ë©´í—ˆ</div>

    </div>

  </div>

  <div class="treeNode" data-root="í–‰ì •">í–‰ì •</div>
  <div class="childGroup">

    <div class="treeNode" data-root="í–‰ì •" data-mid="ì¶œì…êµ­">ì¶œì…êµ­</div>
    <div class="childGroup">

      <div class="treeNode"
           data-root="í–‰ì •"
           data-mid="ì¶œì…êµ­"
           data-leaf="ì²´ë¥˜ìê²©">ì²´ë¥˜ìê²©</div>

      <div class="treeNode"
           data-root="í–‰ì •"
           data-mid="ì¶œì…êµ­"
           data-leaf="ë‹¨ì†">ë‹¨ì†</div>

    </div>

  </div>

</div>

<!-- ====================================
     RIGHT SEARCH PANEL
======================================= -->
<div id="rightPanel">

<h2 style="margin:0;">ì—…ë¬´ ê²€ìƒ‰</h2>

<div style="text-align:right; margin-bottom:10px;">
  ğŸŒ ê³ ì§€ ì–¸ì–´:
  <select id="langSelect">
    <option value="ko" selected>í•œêµ­ì–´</option>
    <option value="en">English</option>
    <option value="zh">ä¸­æ–‡</option>
    <option value="ja">æ—¥æœ¬èª</option>
    <option value="vi">Tiáº¿ng Viá»‡t</option>
  </select>
</div>

<div style="margin-bottom:10px;">
  ğŸ” ë²”ìœ„:
  <label><input type="checkbox" value="criminal" checked> í˜•ì‚¬</label>
  <label><input type="checkbox" value="traffic" checked> êµí†µ</label>
  <label><input type="checkbox" value="contacts" checked> ì—°ë½ì²˜</label>
  <label><input type="checkbox" value="procedure" checked> ì ˆì°¨</label>
  <label><input type="checkbox" value="admin" checked> í–‰ì •</label>
</div>

<input type="text" id="searchBox" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" disabled>

<div id="results">
  <p class="loading">ë²•ê·œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
</div>

</div>
</div>


<script>
let lawsData = [];
let selectedLang = "ko";

let treeRoot=null, treeMid=null, treeLeaf=null;

/**************************************
  JSON LOAD
**************************************/
const sources = [
  { file: "./data/laws_criminal.json", category:"criminal"},
  { file: "./data/laws_traffic.json",  category:"traffic"},
  { file: "./data/laws_contacts.json", category:"contacts"},
  { file: "./data/laws_procedure.json",category:"procedure"},
  { file: "./data/laws_admin.json",    category:"admin"}
];

Promise.allSettled(
  sources.map(s =>
    fetch(s.file)
      .then(r => r.ok ? r.json() : [])
      .then(arr => arr.map(v => ({...v, _category:s.category})))
))
.then(res=>{
  lawsData = res
    .filter(r=>r.status==="fulfilled")
    .flatMap(v=>v.value);

  document.getElementById("searchBox").disabled=false;
  document.getElementById("results").innerHTML="<p>ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>";
});

/**************************************
 HIGHLIGHT FUNCTION
**************************************/
function highlight(text, kw){
  if(!kw) return text;
  const rg = new RegExp(kw, "gi");
  return text.replace(rg, m=>`<span class="highlight">${m}</span>`);
}

/**************************************
 CATEGORY CHECKBOX
**************************************/
function selectedCategory(){
  return Array.from(
    document.querySelectorAll('input[type="checkbox"]:checked')
  ).map(cb=>cb.value);
}

/**************************************
 MAIN SEARCH ENGINE (Tree + Keywords)
**************************************/
function runSearch(){

  const kw = document.getElementById("searchBox").value.toLowerCase();
  const keys = kw.split(",").map(a=>a.trim()).filter(a=>a.length>0);

  const cat = selectedCategory();

  let result = lawsData.filter(item=>{

    if(!cat.includes(item._category)) return false;

    if(treeRoot && item.root!==treeRoot) return false;
    if(treeMid  && item.mid !==treeMid ) return false;
    if(treeLeaf && item.leaf!==treeLeaf) return false;

    if(keys.length===0) return true;

    const t = (item.text||"").toLowerCase();
    const l = item.law.join(" ").toLowerCase();

    let n = "";
    if(typeof item.note==="string"){ n=item.note.toLowerCase(); }
    else if(typeof item.note==="object"){
      n = Object.values(item.note).join(" ").toLowerCase();
    }

    return keys.every(k=> t.includes(k)||l.includes(k)||n.includes(k));
  });

  show(result, keys);
}

/**************************************
 RESULT DISPLAY
**************************************/
function show(arr, keys){
  const box=document.getElementById("results");

  if(arr.length===0){
    box.innerHTML="<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    return;
  }

  box.innerHTML="";

  arr.forEach(item=>{
    const div=document.createElement("div");
    div.className="lawItem";

    let note="";

    if(typeof item.note==="object"){
      note = item.note[selectedLang] || item.note["ko"];
    } else note = item.note;

    keys.forEach(k=>{
      if(k){
        item.text = highlight(item.text,k);
        note     = highlight(note,k);
      }
    });

    div.innerHTML = `
      <h3>${item.law.join(" / ")}</h3>
      <p class="textContent">${item.text}</p>
      <p class="note">${note}</p>
    `;

    box.appendChild(div);
  });
}

/**************************************
 TREE EVENT
**************************************/
document.querySelectorAll(".treeNode").forEach(n=>{
  n.addEventListener("click", e=>{

    document.querySelectorAll(".treeNode")
      .forEach(a=>a.classList.remove("active"));

    n.classList.add("active");

    treeRoot = n.dataset.root || null;
    treeMid  = n.dataset.mid  || null;
    treeLeaf = n.dataset.leaf || null;

    let parent=n.parentElement;
    if(parent.classList.contains("childGroup")){
      parent.classList.toggle("open");
    }

    runSearch();
  });
});

/**************************************
 EVENT LISTENERS
**************************************/
searchBox.addEventListener("input", runSearch);

langSelect.addEventListener("change",e=>{
  selectedLang=e.target.value;
  runSearch();
});

document.querySelectorAll('input[type="checkbox"]')
  .forEach(cb=>cb.addEventListener("change",runSearch));
</script>
</body>
</html>
